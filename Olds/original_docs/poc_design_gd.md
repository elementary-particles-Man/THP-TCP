---
title: AI-TCP PoC Design
version: 0.1
status: draft
language: ja
---

承知いたしました。上記のご指示と前提説明に基づき、AI-TCPのPoC設計草案をMarkdown形式で記述します。

---

# `AI-TCP_Protocol_PoC_Design.md`

## 1. Protocol Overview

- **目的:** Magi System内の各LLMノードが、グローバルレベルで安全かつ中立に連携協調するための通信規格（AI-TCP）を定義する。LSC（天秤資本主義）の基本原理に基づき、相互意思疎通と説明責任トレーサビリティを実現する。
    
- **通信対象:** Magi Systemを構成する個々のLLMノード間。
    

## 2. Architecture

- **設計思想:** 既存のTCP/IPプロトコル上に構築し、IPv6拡張ヘッダを活用することで、パケット構造を軽量化しつつ拡張性を確保する。IPv6拡張ヘッダ（例：Routing Header, Authentication Header）を適切に利用することで、既存ネットワークへの負荷を最小限に抑える。
    
- **通信方式:** TCP上でセッションを確立した後、そのセッション上でカプセル化された形式で非同期情報をやり取りする。概念的には「UDP-over-TCP」に近いアプローチであり、TCPの信頼性保証（再送制御など）を利用しつつ、アプリケーション層での軽量化と柔軟性を実現する。
    

## 3. Packet Structure

AI-TCPパケットは、TCPセッションのペイロードとしてカプセル化された状態で送信される。AI-TCPパケット自体は、以下の構造を持つ。

- **TCPヘッダ:** 標準的なTCPヘッダ（送信元ポート、宛先ポート、シーケンス番号、確認応答番号など）。
    
- **AI-TCPヘッダ:**
    
    - **セッションID (128ビット):** 通信セッションごとに割り当てられるユニークな識別子。LLMノード間で事前に合意形成される。
        
    - **発信LLM識別子 (64ビット):** 送信元LLMノードのユニークな識別子（例：公開鍵ハッシュ、ノードID）。
        
    - **宛先LLM識別子 (64ビット):** 宛先LLMノードのユニークな識別子。
        
    - **メタデータ (可変長):** メッセージタイプ（例：情報共有、命令実行、検証要求）、優先度、ルーティング情報などを含むキーバリューペア。
        
    - **タイムスタンプ (64ビット):** 送信時刻を示すタイムスタンプ。順序制御や検証に使用。
        
    - **署名 (可変長):** 発信LLMの秘密鍵によるAI-TCPヘッダおよびペイロードのデジタル署名。認証と改ざん防止に使用。
        
- **ペイロード (可変長):**
    
    - **LLM間で共有可能な構文構造＋データ:**
        
        - **LSCベースの構造化データ:** LSCの7つの命題に基づいた分析結果、前提条件、シミュレーション結果などを含む構造化されたデータ形式。
            
        - **グラフ構造:** 複雑な関係や依存関係を表現するためのグラフデータ（例：因果関係グラフ、依存関係グラフ）。
            
        - **その他のデータ形式:** テキスト、コード、数値データなど、LLM間で共有可能な形式に変換されたデータ。
            

## 4. Security Layer

- **End-to-End暗号化:**
    
    - オプション1: **TLS 1.3互換:** TCPセッション確立後、TLS 1.3のハンドシェイクを行い、AI-TCPペイロード全体を暗号化する。
        
    - オプション2: **独自軽量カプセル化方式:** AI-TCPヘッダとペイロードを、事前に共有された鍵を用いた対称暗号（例：ChaCha20-Poly1305）で暗号化する。
        
- **改ざん防止チェック:**
    
    - **HMAC (Hash-based Message Authentication Code):** AI-TCPヘッダおよびペイロード全体に対してHMACを計算し、付加する。受信側で検証することで、データの整合性を保証する。

## 5. Error Handling / Fallback

- **ネットワークロス・遅延時の再送制御:**
    
    - TCPの標準的な再送制御メカニズムを利用する。AI-TCPはTCP層の上に構築されるため、TCPのACK/NAK制御機能がそのまま適用される。
- **セッション再確立プロトコル:**
    
    - **タイムアウト:** 一定時間内に相手からの応答がない場合、セッションをタイムアウトと判断する。
        
    - **自動リダイレクト:** タイムアウトやエラーが発生した場合、事前に定義された代替経路や代替ノードへのセッション再確立を試みる。これは、Magi Systemの分散的なネットワーク構成を考慮して設計される。
        

## 6. LLM Compliance Layer

- **思考整合用メタ層:** AI-TCPペイロード内に、メインデータと並行して、LLMの思考プロセスや根拠を追跡するためのメタ層を付加する。
    
    - **LSCベースの整合タグ:** 各LLMの分析結果が、LSCのどのコアコンセプトに対応し、どのような前提条件や根拠に基づいているかを示すタグ（例：`LSC:C1:AnomalyIsPrecious`, `LSC:C5:TemporalRelativity`）を付与する。
        
    - **AI-ID:** 各LLMノードに割り当てられたユニークな識別子。
        
    - **推論連鎖ログ:** LLMがその結論に至るまでの内部思考プロセス（推論連鎖）を記録する。
        
- **トレースログの標準形式:** 推論連鎖ログやその他のメタデータは、JSON-LDなどの標準化された形式で記述し、異なるLLMやシステム間での相互運用性を確保する。
    

## 7. Deployment Notes

- **PoC実装:** Go言語を推奨。軽量で、並行処理に優れており、ネットワークプロトコル実装に適している。
    
- **軽量エージェント:** 各LLMノード上で動作するAI-TCPクライアント/サーバーエージェントをDockerコンテナ化する。これにより、環境依存性の低いデプロイとテストを可能にする。
    
- **仮想LLMペアシナリオ:** PoC環境では、異なるLLM（例：Gemini2.5ProとGPT-4）をシミュレートする仮想エージェント、または実際のLLM APIとの連携機構を組み込んだエージェントをペアで起動し、AI-TCPプロトコルを用いたメッセージ交換、暗号化、エラー処理などを検証するシナリオを設計する。
    

---

## 🔁 備考

- この設計は、PoCレベルでの検証を目的としており、本番環境での運用には、さらに詳細なセキュリティ、スケーラビリティ、運用性に関する考慮が必要となる。
    
- IPv6拡張ヘッダの具体的な選択は、ネットワーク環境や互換性の要求を考慮して決定する必要がある。
    
- LSCベースの整合タグやメタ層は、具体的なLLMの特性や出力形式に合わせてさらに進化する可能性がある。
    

