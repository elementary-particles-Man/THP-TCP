{
  "schema": "THP-TCP-Nickname-Addressing",
  "version": "1.0",
  "encoding": {
    "cbor": { "deterministic": true, "prefer_integer_keys": true },
    "lp_record": { "varint": "uleb128", "u64": "big_endian" }
  },
  "objects": [
    {
      "name": "AddressRef",
      "fields": [
        { "key": 0, "name": "version", "type": "u8", "required": true },
        { "key": 1, "name": "nickname", "type": "bstr", "required": true, "constraints": { "len": [1, 32], "charset": "ascii_lc[a-z0-9._-]" } },
        { "key": 2, "name": "namespace", "type": "bstr", "required": false, "constraints": { "len": [1, 32], "charset": "ascii_lc[a-z0-9._-]" } },
        { "key": 3, "name": "timestamp_ns", "type": "u64", "required": true },
        { "key": 4, "name": "destination_uri", "type": "tstr", "required": false },
        { "key": 5, "name": "ttl_ms", "type": "u32", "required": false },
        { "key": 6, "name": "meta", "type": "map", "required": false },
        { "key": 7, "name": "sig", "type": "bstr", "required": false, "note": "upper-layer" }
      ],
      "unknown_keys": "ignore"
    },
    {
      "name": "AddressBinding",
      "fields": [
        { "key": 0, "name": "version", "type": "u8", "required": true },
        { "key": 1, "name": "nickname", "type": "bstr", "required": true, "constraints": { "len": [1, 32], "charset": "ascii_lc[a-z0-9._-]" } },
        { "key": 2, "name": "namespace", "type": "bstr", "required": false, "constraints": { "len": [1, 32], "charset": "ascii_lc[a-z0-9._-]" } },
        { "key": 3, "name": "timestamp_ns", "type": "u64", "required": true },
        { "key": 4, "name": "endpoint_kind", "type": "u8", "required": true, "enum": { "0": "node_id", "1": "ipv6", "2": "uri" } },
        { "key": 5, "name": "endpoint", "type": "bstr_or_tstr", "required": true },
        { "key": 6, "name": "ttl_ms", "type": "u32", "required": false },
        { "key": 7, "name": "priority", "type": "u8", "required": false },
        { "key": 8, "name": "meta", "type": "map", "required": false },
        { "key": 9, "name": "sig", "type": "bstr", "required": false, "note": "upper-layer" }
      ],
      "unknown_keys": "ignore"
    }
  ],
  "resolution_order": [
    "local_override",
    "local_cache",
    "namespace_resolver_if_present",
    "global_registry_if_enabled",
    "error_not_found"
  ],
  "errors": {
    "INVALID_NAME": 1,
    "NOT_FOUND": 2,
    "UNSUPPORTED_ENDPOINT_KIND": 3
  },
  "reserved_names": ["system", "root", "global", "local", "null"]
}
